"0","library(plyr)"
"0",""
"0","# For each prediction raster brick, mask the raster layer by Argentina EEZ, convert the prediction raster into data frame, and then stack the data frame for ggplot"
"0","dat <- lapply(r, FUN=function(x){"
"0","  x %>% as.data.frame(xy = TRUE, na.rm = TRUE) %>% gather(-x, -y, key = ""var"", value = ""value"")"
"0","}) %>% ldply(.id=""Taxa"")"
"0","dat$var <- factor(dat$var, labels=c(""1951-2000"", ""2041-2060"", ""2081-2100""))"
"0",""
"0","ggplot(dat) +"
"0","  geom_raster(aes(x=x, y=y, fill=value))+"
"0","  geom_polygon(data=land, aes(x=X, y=Y, group=PID), fill=""bisque2"", colour=""transparent"")+"
"0","  geom_sf(data=as(eez, ""sf""), fill=""transparent"", colour=""red"")+"
"0","  geom_contour(data=bathy, aes(x=x, y=y, z=layer), breaks=-200, linetype=2, colour=""gray50"")+"
"0","  geom_contour(data=bathy, aes(x=x, y=y, z=layer), breaks=-4000, linetype=1, colour=""gray50"")+"
"0","  geom_point(data=occ, aes(x=decimalLongitude, y=decimalLatitude), size=0.2)+"
"0","  facet_grid(Taxa~var)+"
"0","  scale_fill_gradientn(colours=brewer.pal(10, 'RdYlBu') %>% rev, na.value=""white"")+"
"0","  scale_x_continuous(expand = expansion(mult = 0))+"
"0","  scale_y_continuous(expand = expansion(mult = 0))+"
"0","  labs(x=NULL, y=NULL, fill=""Habitat\nSuitability"")+"
"0","  theme_bw() %+replace% theme(legend.position = ""top"", legend.key.width =  unit(1, 'cm'))"
