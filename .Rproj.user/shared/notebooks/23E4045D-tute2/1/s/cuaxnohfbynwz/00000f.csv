"0","cum_imp <- function(r){"
"0","  # Negative cumulative impact (exposure to climate change hazards for epc<0, o2<0, ph<0, and thetao>0)"
"0","  neg <- addLayer(calc(subset(r, 1:3), fun=function(x){x[x>0]<-NA; return(-x)}),"
"0","                    calc(subset(r, 4), fun=function(x){x[x<0]<-NA; return(x)})"
"0","                    ) %>% overlay(fun=function(x)sum(x, na.rm=T))"
"0",""
"0","  # Positive cumulative impact (exposure to climate change hazards for epc>0, o2>0, ph>0, and thetao<0)"
"0","  pos <- addLayer(calc(subset(r, 1:3), fun=function(x){x[x<0]<-NA; return(x)}),"
"0","                    calc(subset(r, 4), fun=function(x){x[x>0]<-NA; return(-x)})"
"0","                    ) %>% overlay(fun=function(x)sum(x, na.rm=T))"
"0","  "
"0","  out <- addLayer(neg, pos)"
"0","  names(out) <- c(""Negative"", ""Positive"")"
"0","  out <- mask(out, etopo2022)"
"0","  return(out)"
"0","}"
