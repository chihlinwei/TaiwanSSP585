"0","# Custom function to mask habitats"
"0","mask_habitat <- function(x){"
"0","  pred <- addLayer(etopo2022, x)"
"0","  # Mask continental margin"
"0","  ma <- pred %>% mask(eez) %>% as.data.frame(xy = TRUE, na.rm = TRUE)"
"0","  ma$Habitat <- cut(-ma$layer, c(0, 200, 6000), labels=c(""Shelf"", ""Slope""))"
"0","  # Mask submarine canyons"
"0","  sc <- pred %>% mask(canyon) %>% mask(eez) %>% as.data.frame(xy = TRUE, na.rm = TRUE)"
"0","  sc$Habitat <- ""Canyon"""
"0","  # Mask seamounts"
"0","  sm <- pred %>% mask(seamount) %>% mask(eez) %>% as.data.frame(xy = TRUE, na.rm = TRUE)"
"0","  sm$Habitat <- ""Seamount"""
"0","  # Mask cold water corals"
"0","  cwc <- pred %>% mask(coral) %>% mask(eez) %>% as.data.frame(xy = TRUE, na.rm = TRUE)"
"0","  cwc$Habitat <- ""CWC"""
"0","  # Combine and stack data frame"
"0","  rbind(ma, sc, sm, cwc) %>% gather(-x, -y, -layer, -Habitat, key = ""var"", value = ""value"", factor_key=TRUE)"
"0","}"
