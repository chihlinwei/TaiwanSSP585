"0","keep_b <- "
"0","  function(x){"
"0","  y <- NULL"
"0","  for(j in 1:dim(x)[4]){"
"0","    b <- x[,,1,j]"
"0","    for(i in 2:dim(x)[3]){"
"0","      # Next layer"
"0","      n <- x[,,i,j]"
"0","      # Replace surface with next layer"
"0","      b[!is.na(n)] <- n[!is.na(n)]"
"0","    }"
"0","    # Combine data"
"0","    y <- abind(y, b, along=3)"
"0","  }"
"0","  return(y)"
"0","}"
