# Combine data
o <- abind(o, b, along=3)
}
dim(o)
?dim
# Seawater pH from 2021 to 2030
m1 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_ssp585_r1i1p1f1_gr_2021-2030.nc")
a1 <- ncvar_get(m1, "ph")
# Seawater pH from 2019 to 2100
m2 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_ssp585_r1i1p1f1_gr_2091-2100.nc")
a2 <- ncvar_get(m2, "ph")
# Dimensions of model projections
dim(a1)
keep_b(a1) %>% dim
b1 <- keep_b(a1)
b2 <- keep_b(a2)
dim(a1)
b1 <- keep_b(a1)
b2 <- keep_b(a2)
# Dimensions of the bottom most projections
dim(b1)
cbind(x, y, value=b1[,,1] %>% as.vector )
# Coordinates of each grid
y <- as.vector(ncvar_get(m, "lat"))
# Coordinates of each grid
y <- as.vector(ncvar_get(m1, "lat"))
# Coordinates of each grid
y <- as.vector(ncvar_get(m1, "latitude"))
x <- as.vector(ncvar_get(m1, "longitude"))
x[x>180] <- x[x>180]-360
cbind(x, y, value=b1[,,1] %>% as.vector )
b2021 <- cbind(x, y, value=b1[,,1] %>% as.vector) %>% data.frame %>% na.omit
b2021
# First layer of b1
b2021 <- cbind(x, y, value=b1[,,1] %>% as.vector) %>% data.frame %>% na.omit
# 10th layer of b2
b2100 <- cbind(x, y, value=b2[,,10] %>% as.vector) %>% data.frame %>% na.omit
b2021
b2100
library(ggplot2)
out <- rbind(cbind(b2021, Year=2021), cbind(b2100, Year=2100))
head(out)
out <- rbind(cbind(b2021, year=2021), cbind(b2100, year=2100))
ggplot(data = out)+
geom_raster(aes(x=x, y=y, fill=value))+
facet_wrap(~year)
ggplot(data = out)+
geom_raster(aes(x=x, y=y, fill=value))
head(out)
str(out)
head(out)
ggplot(b2100)+
geom_raster(aes(x=x, y=y, fill=value))
ggplot(b2100)+
geom_tile(aes(x=x, y=y, fill=value))
head(b2100)
ggplot(b2020)+
geom_tile(aes(x=x, y=y, fill=value))
ggplot(b2021)+
geom_tile(aes(x=x, y=y, fill=value))
image(b1[,,1])
?geom_raster
ggplot(b2021)+
geom_raster(aes(x=x, y=y, fill=value))
ggplot(b2021)+
geom_tile(aes(x=x, y=y, fill=value))
# First layer of b1
b2021 <- cbind(x, y, value=b1[,,1] %>% as.vector) %>% data.frame
# 10th layer of b2
b2100 <- cbind(x, y, value=b2[,,10] %>% as.vector) %>% data.frame
out <- rbind(cbind(b2021, year=2021), cbind(b2100, year=2100))
ggplot(b2021)+
+     geom_tile(aes(x=x, y=y, fill=value))
ggplot(b2021)+geom_tile(aes(x=x, y=y, fill=value))
ggplot(b2021)+geom_raster(aes(x=x, y=y, fill=value))
plot(b2100)
b2100
ggplot(b2100)+
geom_tile(aes(x=x, y=y, fill=value))+
facet_wrap(~year)
# First layer of b1
b2021 <- cbind(x, y, value=b1[,,1] %>% as.vector) %>% data.frame
# 10th layer of b2
b2100 <- cbind(x, y, value=b2[,,10] %>% as.vector) %>% data.frame
out <- rbind(cbind(b2021, year=2021), cbind(b2100, year=2100))
ggplot(b2100)+
geom_tile(aes(x=x, y=y, fill=value))+
facet_wrap(~year)
ggplot(out)+
geom_tile(aes(x=x, y=y, fill=value))+
facet_wrap(~year)
plot(y~x, b2021, pch=".")
# Coordinates of each grid
y <- as.vector(ncvar_get(m1, "latitude"))
x <- as.vector(ncvar_get(m1, "longitude"))
y
x
# Coordinates of each grid
y <- as.vector(ncvar_get(m1, "latitude"))
x <- as.vector(ncvar_get(m1, "longitude"))
#x[x>180] <- x[x>180]-360
image(b1)
image(b1[,,1])
# Seawater pH from 2021 to 2030
m1 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_ssp585_r1i1p1f1_gr_2021-2030.nc")
a1 <- ncvar_get(m1, "ph")
# Seawater pH from 2019 to 2100
m2 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_ssp585_r1i1p1f1_gr_2091-2100.nc")
a2 <- ncvar_get(m2, "ph")
# Dimensions of model projections
dim(a1)
keep_b <-
function(x){
y <- NULL
for(j in 1:dim(x)[4]){
b <- x[,,1,j]
for(i in 2:dim(x)[3]){
# Next layer
n <- x[,,i,j]
# Replace surface with next layer
b[!is.na(n)] <- n[!is.na(n)]
}
# Combine data
y <- abind(y, b, along=3)
}
return(y)
}
b1 <- keep_b(a1)
b2 <- keep_b(a2)
# Dimensions of the bottom most projections
dim(b1)
# Coordinates of each grid
y <- as.vector(ncvar_get(m1, "latitude"))
x <- as.vector(ncvar_get(m1, "longitude"))
x[x>180] <- x[x>180]-360
# First layer of b1
b2021 <- cbind(x, y, value=b1[,,1] %>% as.vector) %>% data.frame
# 10th layer of b2
b2100 <- cbind(x, y, value=b2[,,10] %>% as.vector) %>% data.frame
out <- rbind(cbind(b2021, year=2021), cbind(b2100, year=2100))
plot(y~x, b2021, pch=".")
plot(y~x, b2100, pch=".")
# First layer of b1
b2021 <- cbind(x, y, value=b1[,,1] %>% as.vector) %>% data.frame %>%　na.omit
# 10th layer of b2
b2100 <- cbind(x, y, value=b2[,,10] %>% as.vector) %>% data.frame %>%　na.omit
out <- rbind(cbind(b2021, year=2021), cbind(b2100, year=2100))
plot(y~x, b2100, pch=".")
ggplot(b2021)+
geom_tile(aes(x=x, y=y, fill=value))
ggplot(b2021)+
geom_tile(aes(x=x, y=y, fill=value))
ggplot(b2021)+
geom_tile(aes(x=x, y=y, fill=value))+
geom_sf()
?geom_sf
?image
ggplot(data=b2021, aes(x=x, y=y))+
geom_tile(value)
head(b2021)
ggplot(data=b2021, aes(x=x, y=y))+
geom_tile(aes(fill=value))
ggplot(data=b2021, aes(x=x, y=y, fill=value))+
geom_tile()
ggplot(data=b2021, aes(x=x, y=y))+
geom_point()
ggplot(data=b2021, aes(x=x, y=y, colour=value))+
geom_point()
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
facet_wrap(~year)
?geom_raster
ggplot(data=out, aes(x=x, y=y, fill=value))+
geom_raster()+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
facet_wrap(~year)
?coord_map
?scale_colour_brewer
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
scale_colour_brewer(palette = "Spectral")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
scale_colour_brewer(palette = "YlOrRd")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
scale_colour_viridis_c()+
facet_wrap(~year)
?scale_colour_viridis_c
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
?nc_open
knitr::opts_chunk$set(
collapse = TRUE,
message=FALSE,
warning=FALSE,
comment = "#>"
)
library(ncdf4)
library(abind)
library(dplyr)
library(ggplot2)
?nc_open
?ncvar_get
# Seawater pH from 1950 to 1959
m0 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_historical_r1i1p1f1_gr_1950-1959.nc")
a0 <- ncvar_get(m0, "ph")
# Seawater pH from 2021 to 2030
m1 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_ssp585_r1i1p1f1_gr_2021-2030.nc")
a1 <- ncvar_get(m1, "ph")
# Seawater pH from 2019 to 2100
m2 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_ssp585_r1i1p1f1_gr_2091-2100.nc")
a2 <- ncvar_get(m2, "ph")
# Dimensions of model projections
dim(a1)
keep_b <-
function(x){
y <- NULL
for(j in 1:dim(x)[4]){
b <- x[,,1,j]
for(i in 2:dim(x)[3]){
# Next layer
n <- x[,,i,j]
# Replace surface with next layer
b[!is.na(n)] <- n[!is.na(n)]
}
# Combine data
y <- abind(y, b, along=3)
}
return(y)
}
b0 <- keep_b(a0)
b1 <- keep_b(a1)
b2 <- keep_b(a2)
# Dimensions of the bottom most projections
dim(b1)
# Coordinates of each grid
y <- as.vector(ncvar_get(m1, "latitude"))
x <- as.vector(ncvar_get(m1, "longitude"))
x[x>180] <- x[x>180]-360
# 1950: first layer of b0
b1950 <- cbind(x, y, value=b0[,,1] %>% as.vector) %>% data.frame %>%　na.omit
# 2021: first layer of b1
b2021 <- cbind(x, y, value=b1[,,1] %>% as.vector) %>% data.frame %>%　na.omit
# 2100: 10th layer of b2
b2100 <- cbind(x, y, value=b2[,,10] %>% as.vector) %>% data.frame %>%　na.omit
out <- rbind(cbind(b1950, year=1950), cbind(b2021, year=2021), cbind(b2100, year=2100))
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
# 1950: first layer of b0
b1950 <- cbind(x, y, value=b0[,,1] %>% as.vector) %>% data.frame %>%　na.omit
# 2021: first layer of b1
b2025 <- cbind(x, y, value=b1[,,5] %>% as.vector) %>% data.frame %>%　na.omit
# 2100: 10th layer of b2
b2100 <- cbind(x, y, value=b2[,,10] %>% as.vector) %>% data.frame %>%　na.omit
out <- rbind(cbind(b1950, year=1950), cbind(b2025, year=2025), cbind(b2100, year=2100))
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
knitr::opts_chunk$set(
collapse = TRUE,
message=FALSE,
warning=FALSE,
comment = "#>"
)
library(ncdf4)
library(abind)
library(dplyr)
library(ggplot2)
# Seawater pH from 1850 to 1859
m1 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_historical_r1i1p1f1_gr_1850-1859.nc")
a1 <- ncvar_get(m1, "ph")
# Seawater pH from 1950 to 1959
m2 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_historical_r1i1p1f1_gr_1950-1959.nc")
a2 <- ncvar_get(m2, "ph")
# Seawater pH from 2021 to 2030
m3 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_ssp585_r1i1p1f1_gr_2021-2030.nc")
a3 <- ncvar_get(m3, "ph")
# Seawater pH from 2019 to 2100
m4 <- nc_open("C:/Users/user/Downloads/ph_Oyr_NorESM2-MM_ssp585_r1i1p1f1_gr_2091-2100.nc")
a4 <- ncvar_get(m4, "ph")
# Dimensions of model projections
dim(a1)
keep_b <-
function(x){
y <- NULL
for(j in 1:dim(x)[4]){
b <- x[,,1,j]
for(i in 2:dim(x)[3]){
# Next layer
n <- x[,,i,j]
# Replace surface with next layer
b[!is.na(n)] <- n[!is.na(n)]
}
# Combine data
y <- abind(y, b, along=3)
}
return(y)
}
b1 <- keep_b(a1)
b2 <- keep_b(a2)
b3 <- keep_b(a3)
b4 <- keep_b(a4)
# Dimensions of the bottom most projections
dim(b1)
# Coordinates of each grid
y <- as.vector(ncvar_get(m1, "latitude"))
x <- as.vector(ncvar_get(m1, "longitude"))
x[x>180] <- x[x>180]-360
# 1850: first layer of b1
b1850 <- cbind(x, y, value=b1[,,1] %>% as.vector) %>% data.frame %>%　na.omit
# 1950: first layer of b2
b1950 <- cbind(x, y, value=b2[,,1] %>% as.vector) %>% data.frame %>%　na.omit
# 2021: first layer of b3
b2025 <- cbind(x, y, value=b3[,,5] %>% as.vector) %>% data.frame %>%　na.omit
# 2100: 10th layer of b4
b2100 <- cbind(x, y, value=b4[,,10] %>% as.vector) %>% data.frame %>%　na.omit
out <- rbind(cbind(b1850, year=1850), cbind(b1950, year=1950), cbind(b2025, year=2025), cbind(b2100, year=2100))
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
d1 <- apply(b1, c(1,2), mean)
dim(d1)
# Average of 1850 to 1859
d1 <- apply(b1, c(1,2), mean)
# Average of 1950 to 1959
d2 <- apply(b3, c(1,2), mean)
# Average of 2021 to 2030
d3 <- apply(b4, c(1,2), mean)
# Average of 2019 to 2100
d4 <- apply(b5, c(1,2), mean)
# Average of 1850 to 1859
d1 <- apply(b1, c(1,2), mean)
# Average of 1950 to 1959
d2 <- apply(b2, c(1,2), mean)
# Average of 2021 to 2030
d3 <- apply(b3, c(1,2), mean)
# Average of 2019 to 2100
d4 <- apply(b4, c(1,2), mean)
out <- rbind(cbind(d1, year="1850s"), cbind(d2, year="1950s"), cbind(d3, year="2020s"), cbind(d4, year="2090s"))
head(out)
d1
cbind(x, y, value=b1 %>% apply(c(1,2), mean) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 1850 to 1859
b1850s <- cbind(x, y, value=b1 %>% apply(c(1,2), mean) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 1950 to 1959
b1950s <- cbind(x, y, value=b2 %>% apply(c(1,2), mean) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 2021 to 2030
b2020s <- cbind(x, y, value=b3 %>% apply(c(1,2), mean) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 2091 to 2100
b2090s <- cbind(x, y, value=b4 %>% apply(c(1,2), mean) %>% as.vector) %>% data.frame %>%　na.omit
out <- rbind(cbind(b1850s, year="Average 1850 to 1859"), cbind(b1950s, year="Average 1950 to 1959"), cbind(b2020s, year="Average 2021 to 2030"), cbind(b2090s, year="Average 2091 to 2100"))
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
# Decadal average from 1850 to 1859
b1850s <- cbind(x, y, value=b1 %>% apply(c(1,2), sd) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 1950 to 1959
b1950s <- cbind(x, y, value=b2 %>% apply(c(1,2), sd) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 2021 to 2030
b2020s <- cbind(x, y, value=b3 %>% apply(c(1,2), sd) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 2091 to 2100
b2090s <- cbind(x, y, value=b4 %>% apply(c(1,2), sd) %>% as.vector) %>% data.frame %>%　na.omit
out <- rbind(cbind(b1850s, year="Stdev 1850 to 1859"), cbind(b1950s, year="Stdev 1950 to 1959"), cbind(b2020s, year="Stdev 2021 to 2030"), cbind(b2090s, year="Stdev 2091 to 2100"))
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo")+
facet_wrap(~year)
?scale_colour_viridis_c
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.04))+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.05))+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.06))+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.07))+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.1))+
facet_wrap(~year)
quantile(out$value, 0.01, 0.999)
quantile(out$value, c(0.01, 0.999))
quantile(out$value, c(0.01, 0.9999))
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.04))+
facet_wrap(~year)
# Decadal average from 1850 to 1859
o1 <- cbind(x, y, value=b1 %>% apply(c(1,2), function(x)sd(x)/mean(x)) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 1950 to 1959
o2 <- cbind(x, y, value=b2 %>% apply(c(1,2), function(x)sd(x)/mean(x)) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 2021 to 2030
o3 <- cbind(x, y, value=b3 %>% apply(c(1,2), function(x)sd(x)/mean(x)) %>% as.vector) %>% data.frame %>%　na.omit
# Decadal average from 2091 to 2100
o4 <- cbind(x, y, value=b4 %>% apply(c(1,2), function(x)sd(x)/mean(x)) %>% as.vector) %>% data.frame %>%　na.omit
out <- rbind(cbind(o1, year="Stdev 1850 to 1859"), cbind(o2, year="Stdev 1950 to 1959"), cbind(o3, year="Stdev 2021 to 2030"), cbind(o4, year="Stdev 2091 to 2100"))
out <- rbind(cbind(o1, year="cv 1850 to 1859"), cbind(o2, year="cv 1950 to 1959"), cbind(o3, year="cv 2021 to 2030"), cbind(o4, year="cv 2091 to 2100"))
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.04))+
facet_wrap(~year)
quantile(out$value, 0.999)
quantile(out$value, 0.99)
ggplot(data=out, aes(x=x, y=y, colour=value))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.005))+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value*100))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH(%)")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.005))+
facet_wrap(~year)
ggplot(data=out, aes(x=x, y=y, colour=value*100))+
geom_point()+
coord_map()+
labs(x="", y="", colour="pH(%)")+
scale_colour_viridis_c(option = "turbo", limits=c(0, 0.5))+
facet_wrap(~year)
